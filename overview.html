<!DOCTYPE html>
<html lang="en">

<head>
    <title>Brane SDK Overview</title>
</head>

<body>
    <h1>Brane 0.3.0</h1>
    <p>A modern, type-safe JVM SDK for Ethereum and EVM chains. Built on Java 21. Focused on clarity, correctness, and
        developer experience.</p>

    <h2>Feature Reference</h2>

    <h3>1. Core Connectivity and RPC</h3>
    <ul>
        <li><b>JSON-RPC Client</b>: Robust HTTP client for communicating with Ethereum nodes (Geth, Besu, Anvil, etc.).
        </li>
        <li><b>Request ID Correlation</b>: Automatic correlation of requests and responses in logs for easier debugging.
        </li>
        <li><b>Typed RPC Methods</b>: Strongly-typed wrappers for standard methods like <code>eth_call</code>,
            <code>eth_estimateGas</code>, <code>eth_sendRawTransaction</code>, etc.
        </li>
        <li><b>Smart Retry Logic</b>: Automatic retries for transient network errors with exponential backoff.</li>
    </ul>

    <h3>2. Transaction Management</h3>
    <ul>
        <li><b>Unified TxBuilder</b>: Fluent API for creating both <b>EIP-1559</b> (default) and <b>Legacy</b>
            transactions.</li>
        <li><b>Smart Gas Defaults</b>:
            <ul>
                <li>Auto-estimates gas limit with a safety buffer.</li>
                <li>Auto-calculates EIP-1559 fees (<code>maxFeePerGas</code>, <code>maxPriorityFeePerGas</code>) based
                    on network conditions.</li>
            </ul>
        </li>
        <li><b>Access Lists (EIP-2930)</b>: Support for specifying access lists to reduce gas costs.</li>
        <li><b>Offline Signing</b>: Secure transaction signing using <code>PrivateKey</code> from <code>brane-core</code>.</li>
        <li><b>Nonce Management</b>: Automatic nonce handling via <code>Brane.Signer</code>.</li>
    </ul>

    <h3>3. Smart Contracts and ABI</h3>
    <ul>
        <li><b>Runtime Binding</b>: Bind Java interfaces directly to deployed contracts using
            <code>BraneContract.bind()</code>. No code generation required.
        </li>
        <li><b>ABI Encoding/Decoding</b>:
            <ul>
                <li>Full support for standard Solidity types (<code>uint</code>, <code>address</code>,
                    <code>string</code>, <code>bytes</code>, arrays, tuples).
                </li>
                <li><b>Constructor Encoding</b>: Helper <code>Abi.encodeConstructor()</code> for contract deployment.
                </li>
                <li><b>Event Decoding</b>: Decode logs into typed objects.</li>
            </ul>
        </li>
        <li><b>Revert Handling</b>:
            <ul>
                <li><b>Typed Exceptions</b>: <code>RevertException</code> distinguishes between execution reverts and
                    RPC errors.</li>
                <li><b>Automatic Decoding</b>: Decodes <code>Error(string)</code>, <code>Panic(uint256)</code>, and
                    custom errors automatically.</li>
            </ul>
        </li>
    </ul>

    <h3>4. High-Performance Core</h3>
    <ul>
        <li><b>Zero-Copy ABI Encoding</b>: Optimized encoder that writes directly to buffers, achieving <b>1.42x speedup</b> over Web3j.</li>
        <li><b>Fast Signing</b>: Deterministic ECDSA signer with direct recovery ID calculation, <b>4x faster</b> for EIP-1559 transactions.</li>
        <li><b>Low Allocation</b>: Minimized object churn in hot paths (encoding, hashing, signing).</li>
    </ul>

    <h3>5. Developer Experience</h3>
    <ul>
        <li><b>Granular Logging</b>: Configurable logging via <code>BraneDebug</code> (RPC payloads, Tx lifecycle, Gas
            estimation).</li>
        <li><b>Zero-Dependency Primitives</b>: Standalone <code>Hex</code> and <code>RLP</code> utilities in
            <code>brane-primitives</code>.
        </li>
        <li><b>Java 21 Native</b>: Leverages Records, Pattern Matching, and Virtual Threads.</li>
    </ul>

    <h3>6. Testing Support</h3>
    <ul>
        <li><b>Test Client</b>: <code>Brane.Tester</code> provides comprehensive testing capabilities for Anvil, Hardhat, and Ganache.
        </li>
        <li><b>State Snapshots</b>: Save and restore chain state with <code>snapshot()</code> and <code>revert()</code> for test isolation.
        </li>
        <li><b>Impersonation</b>: Send transactions as any address without private keys via <code>ImpersonationSession</code>.
        </li>
        <li><b>Account Manipulation</b>: Set balance, code, nonce, and storage slots directly with <code>setBalance()</code>, <code>setCode()</code>, <code>setNonce()</code>, <code>setStorageAt()</code>.
        </li>
        <li><b>Mining Control</b>: Control block mining with <code>mine()</code>, <code>setAutomine()</code>, and <code>setIntervalMining()</code>.
        </li>
        <li><b>Time Manipulation</b>: Advance blockchain time with <code>increaseTime()</code> and <code>setNextBlockTimestamp()</code>.
        </li>
        <li><b>State Persistence</b>: Dump and load chain state for test fixtures (Anvil only).
        </li>
        <li><b>Fork Mode</b>: Reset and fork from live networks at specific block numbers.
        </li>
    </ul>

    <h2>Module Structure</h2>
    <ul>
        <li><b>brane-core</b>: Domain types (<code>Address</code>, <code>Wei</code>, <code>HexData</code>), error
            hierarchy, and chain configurations.</li>
        <li><b>brane-rpc</b>: The primary entry point. Contains <code>Brane.Reader</code> for reads,
            <code>Brane.Signer</code> for writes, and <code>Brane.Tester</code> for test node operations.
            Use <code>Brane.connect()</code> for production and <code>Brane.connectTest()</code> for testing.
        </li>
        <li><b>brane-contract</b>: The ABI engine and contract binding logic.</li>
        <li><b>brane-primitives</b>: Low-level encoding utilities (Hex, RLP).</li>
    </ul>

    <h2>Client Hierarchy</h2>
    <p>The SDK provides a sealed client hierarchy for type-safe blockchain interactions:</p>
    <ul>
        <li><b><code>Brane.Reader</code></b>: Read-only operations (queries, calls, subscriptions)</li>
        <li><b><code>Brane.Signer</code></b>: Full operations including transaction signing and sending</li>
        <li><b><code>Brane.Tester</code></b>: Test node operations (snapshots, impersonation, time manipulation)</li>
    </ul>
    <p>The sealed hierarchy enables exhaustive pattern matching in Java 21+:</p>
    <pre>
switch (client) {
    case Brane.Reader r  -&gt; handleReadOnly(r);
    case Brane.Signer s  -&gt; handleSigner(s);
    case Brane.Tester t  -&gt; handleTester(t);
}
    </pre>

    <h2>Quick Start</h2>

    <h3>Read-Only Client</h3>
    <pre>
Brane client = Brane.connect("https://eth-mainnet.g.alchemy.com/v2/...");
BigInteger balance = client.getBalance(address);
    </pre>

    <h3>Signing Client</h3>
    <pre>
Signer key = PrivateKey.fromHex("0x...");
Brane.Signer client = Brane.connect("https://eth.example.com", key);
Hash txHash = client.sendTransaction(request);
    </pre>

    <h3>Test Client (Anvil/Hardhat/Ganache)</h3>
    <pre>
Brane.Tester tester = Brane.connectTest();  // Local Anvil with default key

// Snapshot for test isolation
SnapshotId snapshot = tester.snapshot();
try {
    tester.setBalance(address, Wei.fromEther("1000"));
    // ... test operations ...
} finally {
    tester.revert(snapshot);
}

// Impersonation (act as any address)
try (ImpersonationSession session = tester.impersonate(whaleAddress)) {
    session.sendTransactionAndWait(request);
}

// Time manipulation
tester.increaseTime(86400);  // +1 day
tester.mine();
    </pre>
</body>

</html>