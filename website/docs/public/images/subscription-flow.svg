<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 650 480">
  <defs>
    <marker id="arrow-solid" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#555"/>
    </marker>
    <marker id="arrow-open" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polyline points="0 0, 8 3, 0 6" fill="none" stroke="#555" stroke-width="1.5"/>
    </marker>
  </defs>

  <style>
    .participant { font-family: system-ui, -apple-system, sans-serif; font-size: 13px; font-weight: 600; fill: #333; }
    .message { font-family: ui-monospace, monospace; font-size: 11px; fill: #444; }
    .loop-label { font-family: system-ui, -apple-system, sans-serif; font-size: 11px; font-weight: 600; fill: #666; }
    .box { fill: #f0f9ff; stroke: #0ea5e9; stroke-width: 1.5; rx: 4; }
    .lifeline { stroke: #ccc; stroke-width: 1; stroke-dasharray: 4,3; }
    .loop-box { fill: #fefce8; stroke: #eab308; stroke-width: 1; rx: 4; fill-opacity: 0.3; }
  </style>

  <!-- Participants -->
  <rect x="60" y="15" width="70" height="30" class="box"/>
  <text x="95" y="35" text-anchor="middle" class="participant">App</text>

  <rect x="200" y="15" width="70" height="30" class="box"/>
  <text x="235" y="35" text-anchor="middle" class="participant">Client</text>

  <rect x="360" y="15" width="90" height="30" class="box"/>
  <text x="405" y="35" text-anchor="middle" class="participant">WebSocket</text>

  <rect x="520" y="15" width="70" height="30" class="box"/>
  <text x="555" y="35" text-anchor="middle" class="participant">Node</text>

  <!-- Lifelines -->
  <line x1="95" y1="45" x2="95" y2="455" class="lifeline"/>
  <line x1="235" y1="45" x2="235" y2="455" class="lifeline"/>
  <line x1="405" y1="45" x2="405" y2="455" class="lifeline"/>
  <line x1="555" y1="45" x2="555" y2="455" class="lifeline"/>

  <!-- App -> Client: onNewHeads() -->
  <line x1="95" y1="75" x2="225" y2="75" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="160" y="68" text-anchor="middle" class="message">onNewHeads()</text>

  <!-- Client -> WebSocket: eth_subscribe -->
  <line x1="235" y1="105" x2="395" y2="105" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="315" y="98" text-anchor="middle" class="message">eth_subscribe("newHeads")</text>

  <!-- WebSocket -> Node: Subscribe -->
  <line x1="405" y1="135" x2="545" y2="135" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="475" y="128" text-anchor="middle" class="message">Subscribe</text>

  <!-- Node --> WebSocket: subscription_id -->
  <line x1="545" y1="165" x2="415" y2="165" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="480" y="158" text-anchor="middle" class="message">subscription_id</text>

  <!-- WebSocket --> Client: Subscription -->
  <line x1="395" y1="195" x2="245" y2="195" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="320" y="188" text-anchor="middle" class="message">Subscription</text>

  <!-- Client --> App: Subscription -->
  <line x1="225" y1="225" x2="105" y2="225" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="165" y="218" text-anchor="middle" class="message">Subscription</text>

  <!-- Loop box -->
  <rect x="50" y="250" width="560" height="120" class="loop-box"/>
  <rect x="50" y="250" width="120" height="20" fill="#eab308" rx="4"/>
  <text x="110" y="264" text-anchor="middle" class="loop-label" fill="#fff">On each new block</text>

  <!-- Node --> WebSocket: Block header -->
  <line x1="545" y1="290" x2="415" y2="290" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="480" y="283" text-anchor="middle" class="message">Block header</text>

  <!-- WebSocket --> Client: Notification -->
  <line x1="395" y1="320" x2="245" y2="320" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="320" y="313" text-anchor="middle" class="message">Notification</text>

  <!-- Client --> App: callback(header) -->
  <line x1="225" y1="350" x2="105" y2="350" stroke="#555" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-open)"/>
  <text x="165" y="343" text-anchor="middle" class="message">callback(header)</text>

  <!-- App -> Client: unsubscribe() -->
  <line x1="95" y1="400" x2="225" y2="400" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="160" y="393" text-anchor="middle" class="message">subscription.unsubscribe()</text>

  <!-- Client -> WebSocket: eth_unsubscribe -->
  <line x1="235" y1="430" x2="395" y2="430" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="315" y="423" text-anchor="middle" class="message">eth_unsubscribe(id)</text>

  <!-- WebSocket -> Node: Unsubscribe -->
  <line x1="405" y1="455" x2="545" y2="455" stroke="#555" stroke-width="1.5" marker-end="url(#arrow-solid)"/>
  <text x="475" y="448" text-anchor="middle" class="message">Unsubscribe</text>
</svg>
